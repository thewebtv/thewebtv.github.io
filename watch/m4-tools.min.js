window.M4AFile=(()=>{class t extends Error{constructor(t){super(t),this.name="M4AFileError"}}class e{M4AFileError={invalidBlockType:new t("invalid block type"),invalidFile:new t("invalid M4A file")};#a=["ftyp","mdat","moov","pnot","udta","uuid","moof","free","skip","jP2","wide","load","ctab","imap","matt","kmat","clip","crgn","sync","chap","tmcd","scpt","ssrc","PICT"];#b;get metadataBlock(){return this.#c(["moov","udta","meta","ilst"])}fileName;url;get blocks(){return this.#b}constructor(t){if(this.#b=[],!(t.byteLength>=8))throw this.M4AFileError.invalidFile;let e=0;for(;e<t.length;){let a=t.slice(e,e+4),n=t.slice(e+4,e+8),l=new DataView(a.buffer).getUint32(0),i=new TextDecoder("x-mac-roman").decode(n.buffer);if(!this.#a.includes(i))throw this.M4AFileError.invalidBlockType;let d=!1;if(1==l&&"mdat"==i){let s=t.slice(e+12,e+16);l=new DataView(s.buffer).getUint32(0)}let c=t.subarray(e+8,e+l);e+=l;let $=new r(i,c,null);$.largeAtomSize=d,this.#b.push($)}let u=this.metadataBlock;if(u)for(let g of u.children)void 0==o.StringMetadata[g.type]&&void 0==o.UInt8Metadata[g.type]&&void 0==o.UInt16Metadata[g.type]&&void 0==o.UInt32Metadata[g.type]&&void 0==o.UInt64Metadata[g.type]&&void 0==o.TwoIntMetadata[g.type]&&void 0===o.ImageMetadata[g.type]&&console.log("Unrecognized metadata type: "+g.type)}getStringMetadata(t){let e=this.metadataBlock;if(!e)return null;let a=t.toString(),n=this.getMetadataBlock(e,a);if(!n)return null;let l=this.readMetadata(n);return l?new TextDecoder("utf-8").decode(l):null}getUint8Metadata(t){let e=this.getMetadataBlock(this.metadataBlock,t);return e?9!=e.data.length?(console.warn("UInt8 metadata should have 1 byte of data!"),null):e.data[8]:null}getUint16Metadata(t){let e=this.getMetadataBlock(this.metadataBlock,t);return e?10!=e.data.length?(console.warn("UInt8 metadata should have 2 bytes of data!"),null):new Uint16Array([e.data[9],e.data[8]])[0]:null}getUint32Metadata(t){let e=this.getMetadataBlock(this.metadataBlock,t);return e?12!=e.data.length?(console.warn("UInt8 metadata should have 4 bytes of data!"),null):new Uint32Array([e.data[11],e.data[10],e.data[9],e.data[8]])[0]:null}getUint64Metadata(t){let e=this.getMetadataBlock(this.metadataBlock,t);return e?16!=e.data.length?(console.warn("UInt8 metadata should have 8 bytes of data!"),null):new Uint32Array([e.data[15],e.data[14],e.data[13],e.data[12],e.data[11],e.data[10],e.data[9],e.data[8]])[0]:null}getTwoIntMetadata(t){let e=this.getMetadataBlock(this.metadataBlock,t);if(e){if(16!=e.data.length)return console.warn("Invalid two int metadata read attempted."),null;let a=e.data,n=a.slice(10,12),l=a.slice(12,14);new Uint16Array(n)[0];let i=new Uint16Array(l)[0];return i}}getMetadataBlock(t,e){for(let a of t.children)if(a.type==e)return a;return null}readMetadata(t){let e=t.data,a=e.slice(0,4),n=e.slice(4,8),l=e.slice(8,16);e=e.subarray(a.byteLength+n.byteLength+l.byteLength);let i=new DataView(a.buffer).getUint32(0),r=new TextDecoder("x-mac-roman").decode(n.buffer);return"data"!=r?(console.warn("Could not get metadata entry type"),null):(l.toString()==d.stringIdentifier.toString()||l.toString()==d.intIdentifier.toString())&&i==l.byteLength+n.byteLength+a.byteLength+e.byteLength?e:null}#c(a){if(0==a.length)throw Error("assertion");let n=this.#b;for(let l of a){let i=this.getBlockLevelOne(n,l);if(i){if(l==a[a.length-1])return i;n=i.children}else break}return null}getBlockLevelOne(t,e){for(let a of t)if(a.type===e)return a;return null}}class r{type;data;parent;children=[];largeAtomSize=!1;constructor(t,e,a){if(this.type=t,this.data=e,"moov"==t||"udta"==t||"meta"==t||"ilst"==t||null!=a&&"ilst"==a.type){let n=0;for("meta"==t&&(n+=4);n!=e.length;){let l=e.slice(n,n+4),i=new DataView(l.buffer).getUint32(0),o=e.slice(n+4,n+8),d=new TextDecoder("x-mac-roman").decode(o.buffer),s=e.subarray(n+8,n+i),c=new r(d,s,this);this.children.push(c),n+=i}}}}let o={init(){},StringMetadata:{album:"\xa9alb",artist:"\xa9ART",albumArtist:"aART",comment:"\xa9cmt",title:"\xa9nam",genreCustom:"\xa9gen",composer:"\xa9wrt",encoder:"\xa9too",copyright:"cprt",compilation:"cpil",lyrics:"\xa9lyr",purchaseDate:"purd",grouping:"@grp",misc:"----",sortingTitle:"sonm",sortingAlbum:"soal",sortingArtist:"soar",sortingAlbumArtist:"soaa",sortingComposer:"soco",appleID:"apID",owner:"ownr",xid:"xid ",work:"\xa9wrk",movement:"\xa9mvn"},UInt8Metadata:{rating:"rtng",gapless:"pgap",mediaType:"stik",genreID:"gnre",compilation:"cpil",showMovement:"shwm"},UInt16Metadata:{bpm:"tmpo",movementNumber:"\xa9mvi",movementCount:"\xa9mvc"},UInt32Metadata:{artistID:"atID",genreID:"geID",catalogID:"cnID",countryCode:"sfID",composerID:"cmID"},UInt64Metadata:{collectionID:"plID"},TwoIntMetadata:{track:"trkn",disc:"disc"},ImageMetadata:{artwork:"covr"}},d={stringIdentifier:[0,0,0,1,0,0,0,0],intIdentifier:[0,0,0,21,0,0,0,0]};return e})();